<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.css"
/>

<style>
  .year-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 15px;
  }

  .bg-gallery header {
    grid-column: 1 / -1;
    /* Span all columns */
    width: 100%;
    margin: 20px 0 10px 0;
    font-size: 1.5rem;
    color: #333;
    border-bottom: 1px solid #ddd;
    padding-bottom: 5px;

    a{
      opacity: var(--bs-link-opacity);
    }
  }

  .bg-thumb img {
    width: 100%;
    height: auto;
    min-height: 130px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    transition: transform 0.2s ease;
  }

  .bg-thumb img:hover {
    transform: scale(1.05);
  }

  #navbar-years a.active {
    font-weight: bold;
    text-decoration: none;
  }
</style>

<div id="bg-gallery" class="bg-gallery container-xxl d-flex">

  {% assign bg_files = site.static_files | where_exp: "file", "file.path contains 'assets/backgrounds/'" %}

  {% assign years = "" | split: "" %}

  {% comment %} Collect unique years {% endcomment %}
  {% for file in bg_files %}
  {% unless file.path contains "_thumbs" %}
  {% assign ext = file.extname | downcase %}
  {% if ext == ".jpg" or ext == ".jpeg" or ext == ".png" or ext == ".gif" %}
  {% assign year = file.path | split: "/" | last | slice: 0, 4 %}
  {% unless years contains year %}
  {% assign years = years | push: year %}
  {% endunless %}
  {% endif %}
  {% endunless %}
  {% endfor %}

  {% assign years = years | sort | reverse %}


  <aside class="py-4 order-2 ps-4  pt-4">
    <nav id="navbar-years" class="sticky-top text-end">
      <h5 class="mb-3">Years</h5>
      <ul class="fw-light ps-0 list-unstyled">
        {% for year in years %}
        <li class="ps-0"><a href="#year-{{ year }}">{{ year }}</a></li>
        {% endfor %}
      </ul>
    </nav>
  </aside>


  <div>
    {% comment %} Loop through years and show files {% endcomment %}
    {% for year in years %}
    <div id="year-{{ year }}" class="year-gallery">
      <header class="d-flex justify-content-between ">
        <h2 class="year-gallery-title fw-light ">{{ year }}</h2>
        <a href="#bg-gallery" class="link-opacity-10 link-opacity-100-hover"><i class="bi bi-arrow-bar-up"></i><div class="visually-hidden">Back to top</div></a>
      </header>
      {% for file in bg_files %}
      {% unless file.path contains "_thumbs" %}
      {% assign ext = file.extname | downcase %}
      {% if ext == ".jpg" or ext == ".jpeg" or ext == ".png" or ext == ".gif" %}
      {% assign fname = file.path | split: "/" | last %}
      {% assign file_year = fname | slice: 0, 4 %}
      {% if file_year == year %}
      {% assign name_no_ext = fname | replace: ext, "" %}
      <div class="bg-thumb">
        <a href="{{ site.bg_images_url }}{{ fname }}" target="_blank" title="{{ fname }}" data-fancybox="gallery" data-download-src="{{ site.bg_images_url }}{{ fname }}" data-download-filename="{{ fname }}">
          <img src="{{ site.bg_thumbs_url }}{{ fname }}" alt="{{ fname }}" loading="lazy">
        </a>
      </div>
      {% endif %}
      {% endif %}
      {% endunless %}
      {% endfor %}
    </div>
    {% endfor %}
  </div>

</div>







<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@6.0/dist/fancybox/fancybox.umd.js"></script>
<script>
  Fancybox.bind("[data-fancybox]",{
  Carousel: {
    Toolbar: {
      display: {
        left: ["counter"],
        middle: [],
        right: ["zoom", "play", "download", "thumbs", "close"],
      },
    },
  },
  on: {
    "Carousel.ready Carousel.change": (fancyboxRef, eventName) => {
      // Check if the filename contains "tile"
      const slide = Fancybox.getSlide();
      // Now using the slide.index fetch the correct gallery item link and then the filename

      const src = slide.src;
      const filename = src.split('/').pop().toLowerCase();
      if (filename.includes("_tile")) {
        console.log(slide.el);
        // Add custom css to the slide element using vanilla JS: background-image: src and repeat, and center
        slide.el.style.backgroundImage = `url(${src})`;
        slide.el.style.backgroundRepeat = 'repeat';
        slide.el.style.backgroundSize = 'auto';
        slide.el.style.backgroundPosition = 'center';
      }

    },
  },
});
</script>
